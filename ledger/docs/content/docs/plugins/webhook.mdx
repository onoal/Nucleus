---
title: Webhook
description: Send webhooks when ledger entries are created, updated, or deleted
---

# Webhook Plugin

The Webhook Plugin automatically sends webhooks when ledger entries are created, updated, or deleted.

## Installation

```bash
pnpm add @onoal/ledger-plugins
```

## Usage

```typescript
import { createWebhookPlugin } from "@onoal/ledger-plugins";

const ledger = createLedger({
  plugins: [
    createWebhookPlugin({
      url: "https://api.example.com/webhooks/ledger",
      secret: process.env.WEBHOOK_SECRET,
      retry: {
        maxAttempts: 3,
        delay: 1000,
      },
      onError: (error, event) => {
        console.error("Webhook failed:", error, event);
      },
    }),
  ],
});
```

## Features

- **Automatic Webhooks**: Sends webhooks on create, update, delete events
- **Retry Logic**: Exponential backoff retry mechanism
- **Error Handling**: Custom error callbacks
- **Asynchronous**: Non-blocking webhook sending
- **Signing**: Optional webhook signature for security

## Configuration

### url (required)

The webhook URL to send events to.

```typescript
url: "https://api.example.com/webhooks/ledger";
```

### secret (optional)

Secret for webhook signing. If provided, the secret will be sent in the `X-Webhook-Signature` header.

```typescript
secret: process.env.WEBHOOK_SECRET;
```

### retry (optional)

Retry configuration for failed webhook attempts.

```typescript
retry: {
  maxAttempts: 3,  // Maximum retry attempts
  delay: 1000,     // Initial delay in milliseconds
}
```

### onError (optional)

Error handler callback.

```typescript
onError: (error: Error, event: WebhookEvent) => {
  // Handle error (e.g., log to monitoring service)
};
```

## Webhook Event Format

```typescript
interface WebhookEvent {
  event: "append" | "update" | "delete";
  stream: "proofs" | "assets" | "connect_grants";
  entry: LedgerEntry;
  timestamp: number;
}
```

## Example Event

```json
{
  "event": "append",
  "stream": "proofs",
  "entry": {
    "id": "entry_123...",
    "stream": "proofs",
    "timestamp": 1234567890,
    "payload": {
      "subject_oid": "oid:onoal:user:alice",
      "issuer_oid": "oid:onoal:org:identity",
      "target": "oid:onoal:asset:123",
      "type": "AgeOver18",
      "proof_data": {
        "age": 25,
        "verified": true
      }
    },
    "hash": "hash_123...",
    "prev_hash": "prev_hash_123...",
    "signature": "sig_123...",
    "status": "active"
  },
  "timestamp": 1700000000000
}
```

## Retry Behavior

The plugin uses exponential backoff for retries:

- Attempt 1: Immediate
- Attempt 2: Wait 1s (delay \* 1)
- Attempt 3: Wait 2s (delay \* 2)
- Attempt 4: Wait 3s (delay \* 3)

After max attempts, the error handler is called.

## Next Steps

- [Validation Plugin](/docs/plugins/validation) - Validate entries before storage
- [Indexing Plugin](/docs/plugins/indexing) - Create secondary indexes
